<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo's Cake - Sistema de Pr√©-Vendas</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="images/logo-png.png">
    <link rel="apple-touch-icon" href="images/logo-png.png">
    <meta name="theme-color" content="#ff6b9d">
    <!-- Bibliotecas para PDF e Email -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.emailjs.com/sdk/dist/email.min.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-container" class="login-screen" style="display: none;">
        <div class="login-container">
            <div class="login-form">
                <div class="login-logo">
                    <img src="images/logo-png.png" alt="Leo's Cake">
                </div>
                <h1>Leo's Cake</h1>
                <p>Sistema de Pr√©-Vendas</p>
                <form id="login-form">
                    <input type="password" id="login-password" placeholder="Digite a senha" required>
                    <button type="submit">Entrar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <img src="images/logo-png.png" alt="Leo's Cake" class="splash-logo">
            <h1 class="splash-title">Leo's Cake</h1>
            <p class="splash-subtitle">Sistema de Pr√©-Vendas</p>
            <div class="splash-loader"></div>
        </div>
    </div>

    <!-- Main Container - Todo o sistema -->
    <div id="main-container" class="main-container" style="display: none;">
        
        <!-- Menu de Navega√ß√£o -->
        <nav class="bottom-nav">
        <button class="nav-btn active" data-page="dashboard">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">Dashboard</span>
        </button>
        <button class="nav-btn" data-page="produtos">
            <span class="nav-icon">üßÅ</span>
            <span class="nav-text">Produtos</span>
        </button>
        <button class="nav-btn" data-page="clientes">
            <span class="nav-icon">üë•</span>
            <span class="nav-text">Clientes</span>
        </button>
        <button class="nav-btn" data-page="pedidos">
            <span class="nav-icon">üìã</span>
            <span class="nav-text">Pedidos</span>
        </button>
        <button class="nav-btn" data-page="entregas">
            <span class="nav-icon">üöö</span>
            <span class="nav-text">Entregas</span>
        </button>
    </nav>

    <!-- Header -->
    <header class="header">
        <div class="header-logo">
            <img src="images/logo-png.png" alt="Leo's Cake" class="logo">
            <h1 id="page-title">Dashboard</h1>
        </div>
        <div class="header-actions">
            <div class="sync-indicator" id="sync-indicator">
                <span class="sync-status" id="sync-status">üîÑ</span>
                <span class="sync-text" id="sync-text">Local</span>
            </div>
            <button class="header-btn" id="config-btn">‚öôÔ∏è</button>
            <button class="header-btn" id="sync-btn">üíæ</button>
        </div>
    </header>

    <!-- P√°ginas -->
    <main class="main-content">
        <!-- Dashboard -->
        <div class="page active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-produtos">0</div>
                    <div class="stat-label">Produtos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-clientes">0</div>
                    <div class="stat-label">Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-pedidos">0</div>
                    <div class="stat-label">Pedidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-entregas">0</div>
                    <div class="stat-label">Entregas Hoje</div>
                </div>
            </div>
            
            <div class="recent-section">
                <h3>Entregas de Hoje</h3>
                <div id="entregas-hoje" class="entregas-list">
                    <!-- Entregas ser√£o inseridas aqui -->
                </div>
            </div>
        </div>

        <!-- Produtos -->
        <div class="page" id="produtos">
            <div class="page-header">
                <button class="btn btn-primary" id="add-produto-btn">+ Adicionar Produto</button>
            </div>
            <div class="search-box">
                <input type="text" id="search-produtos" placeholder="Buscar produtos...">
            </div>
            <div id="produtos-list" class="produtos-grid">
                <!-- Produtos ser√£o inseridos aqui -->
            </div>
        </div>

        <!-- Clientes -->
        <div class="page" id="clientes">
            <div class="page-header">
                <button class="btn btn-primary" id="add-cliente-btn">+ Adicionar Cliente</button>
            </div>
            <div class="search-box">
                <input type="text" id="search-clientes" placeholder="Buscar clientes...">
            </div>
            <div id="clientes-list" class="clientes-list">
                <!-- Clientes ser√£o inseridos aqui -->
            </div>
        </div>

        <!-- Pedidos -->
        <div class="page" id="pedidos">
            <div class="page-header">
                <button class="btn btn-primary" id="add-pedido-btn">+ Novo Pedido</button>
            </div>
            <div class="filters">
                <select id="filter-status">
                    <option value="">Todos os Status</option>
                    <option value="pendente">Pendente</option>
                    <option value="pago">Pago</option>
                    <option value="entregue">Entregue</option>
                </select>
            </div>
            <div id="pedidos-list" class="pedidos-list">
                <!-- Pedidos ser√£o inseridos aqui -->
            </div>
        </div>

        <!-- Entregas -->
        <div class="page" id="entregas">
            <div class="page-header">
                <input type="date" id="date-filter" class="date-input">
            </div>
            <div id="entregas-list" class="entregas-agenda">
                <!-- Agenda de entregas ser√° inserida aqui -->
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Modal Produto -->
    <div class="modal" id="produto-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="produto-modal-title">Adicionar Produto</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="produto-form">
                <div class="form-group">
                    <label for="produto-nome">Nome do Produto</label>
                    <input type="text" id="produto-nome" required>
                </div>
                <div class="form-group">
                    <label for="produto-descricao">Descri√ß√£o</label>
                    <textarea id="produto-descricao" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="produto-preco">Pre√ßo (R$)</label>
                    <input type="number" id="produto-preco" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="produto-estoque">Quantidade em Estoque</label>
                    <input type="number" id="produto-estoque" required>
                </div>
                <div class="form-group">
                    <label for="produto-imagem">Imagem do Produto</label>
                    <input type="file" id="produto-imagem" accept="image/*">
                    <div id="preview-imagem" class="image-preview"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-produto">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div class="modal" id="cliente-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cliente-modal-title">Adicionar Cliente</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="cliente-form">
                <div class="form-group">
                    <label for="cliente-nome">Nome Completo</label>
                    <input type="text" id="cliente-nome" required>
                </div>
                <div class="form-group">
                    <label for="cliente-telefone">Telefone</label>
                    <input type="tel" id="cliente-telefone" required>
                </div>
                <div class="form-group">
                    <label for="cliente-endereco">Endere√ßo</label>
                    <textarea id="cliente-endereco" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="cliente-email">Email (opcional)</label>
                    <input type="email" id="cliente-email">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-cliente">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Pedido -->
    <div class="modal" id="pedido-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pedido-modal-title">Novo Pedido</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="pedido-form">
                <div class="form-group">
                    <label for="pedido-cliente">Cliente</label>
                    <select id="pedido-cliente" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Produtos</label>
                    <div id="produtos-pedido" class="produtos-pedido">
                        <!-- Produtos do pedido ser√£o inseridos aqui -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-produto-pedido">+ Adicionar Produto</button>
                </div>
                <div class="form-group">
                    <label for="pedido-valor-total">Valor Total (R$)</label>
                    <input type="number" id="pedido-valor-total" step="0.01" readonly>
                </div>
                <div class="form-group">
                    <label for="pedido-valor-pago">Valor Pago (R$)</label>
                    <input type="number" id="pedido-valor-pago" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="pedido-saldo">Saldo Restante (R$)</label>
                    <input type="number" id="pedido-saldo" step="0.01" readonly>
                </div>
                <div class="form-group">
                    <label>üìÖ Sele√ß√£o de Data e Hor√°rio de Entrega</label>
                    <div class="delivery-scheduler">
                        <!-- Calend√°rio -->
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button type="button" id="prev-month" class="calendar-nav" onclick="app.previousMonth()">‚Äπ</button>
                                <span id="current-month-year"></span>
                                <button type="button" id="next-month" class="calendar-nav" onclick="app.nextMonth()">‚Ä∫</button>
                            </div>
                            <div class="calendar-weekdays">
                                <div class="weekday">Dom</div>
                                <div class="weekday">Seg</div>
                                <div class="weekday">Ter</div>
                                <div class="weekday">Qua</div>
                                <div class="weekday">Qui</div>
                                <div class="weekday">Sex</div>
                                <div class="weekday">S√°b</div>
                            </div>
                            <div id="calendar-days" class="calendar-days">
                                <!-- Dias do calend√°rio ser√£o inseridos aqui -->
                            </div>
                        </div>
                        
                        <!-- Hor√°rios Dispon√≠veis -->
                        <div class="time-slots-container">
                            <h4>üïê Hor√°rios Dispon√≠veis</h4>
                            <div class="selected-date-info">
                                <span id="selected-date-display">Selecione uma data</span>
                            </div>
                            <div id="available-times" class="time-slots">
                                <!-- Hor√°rios dispon√≠veis ser√£o inseridos aqui -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Campos ocultos para armazenar valores -->
                    <input type="hidden" id="pedido-data-entrega" required>
                    <input type="hidden" id="pedido-horario-entrega" required>
                </div>
                <div class="form-group">
                    <label for="pedido-observacoes">Observa√ß√µes</label>
                    <textarea id="pedido-observacoes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-pedido">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div class="modal" id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configura√ß√µes do Sistema</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="config-form">
                <h4>Informa√ß√µes da Empresa</h4>
                <div class="form-group">
                    <label for="empresa-nome">Nome da Empresa</label>
                    <input type="text" id="empresa-nome" value="Leo's Cake" required>
                </div>
                <div class="form-group">
                    <label for="empresa-telefone">Telefone</label>
                    <input type="tel" id="empresa-telefone" placeholder="(11) 99999-9999">
                </div>
                <div class="form-group">
                    <label for="empresa-endereco">Endere√ßo</label>
                    <input type="text" id="empresa-endereco" placeholder="Rua, n√∫mero, bairro, cidade">
                </div>
                <div class="form-group">
                    <label for="empresa-email">Email da Empresa</label>
                    <input type="email" id="empresa-email" placeholder="contato@leoscake.com">
                </div>

                <h4>üîê Seguran√ßa do Sistema</h4>
                <div class="form-group">
                    <label for="sistema-senha">Senha do Sistema</label>
                    <input type="password" id="sistema-senha" placeholder="Digite a nova senha">
                    <small>‚ö†Ô∏è Alterar esta senha for√ßar√° novo login em todos os dispositivos</small>
                </div>

                <h4>üë• Gerenciar Usu√°rios</h4>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="add-user-btn">
                        ‚ûï Adicionar Usu√°rio
                    </button>
                    <small>Adiciona um novo usu√°rio com acesso ao sistema</small>
                </div>
                
                <div class="form-group" id="users-list">
                    <label>Usu√°rios Cadastrados:</label>
                    <div id="users-container" class="users-grid">
                        <!-- Lista de usu√°rios ser√° carregada aqui dinamicamente -->
                    </div>
                </div>

                <!-- Aviso sobre Configura√ß√µes Sens√≠veis -->
                <div id="config-warning" class="config-warning" style="display: none;">
                    <h4>üîí Configura√ß√µes Sens√≠veis</h4>
                    <p>Por seguran√ßa, configura√ß√µes como URLs do Supabase e chaves de API devem ser definidas no arquivo <strong>config.json</strong> ou atrav√©s de vari√°veis de ambiente.</p>
                    <p>Consulte o arquivo <strong>SUPABASE_SETUP.md</strong> para instru√ß√µes detalhadas.</p>
                </div>

                <!-- Configura√ß√µes Sens√≠veis (ocultas em produ√ß√£o) -->
                <div class="sensitive-config" style="display: none;">
                    <h4>‚ö° Configura√ß√µes do Supabase (Desenvolvimento)</h4>
                    <div class="form-group">
                        <label for="supabase-url">Supabase URL</label>
                        <input type="url" id="supabase-url" placeholder="https://seu-projeto.supabase.co">
                        <small>URL do seu projeto no <a href="https://supabase.com" target="_blank">Supabase</a></small>
                    </div>
                    <div class="form-group">
                        <label for="supabase-anon-key">Anon Key</label>
                        <input type="password" id="supabase-anon-key" placeholder="eyJhbGciOiJIUzI1NI...">
                        <small>Chave p√∫blica (anon/public) do projeto</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="supabase-realtime">
                            Ativar Sincroniza√ß√£o em Tempo Real
                        </label>
                        <small>Mudan√ßas ser√£o sincronizadas automaticamente entre dispositivos</small>
                    </div>
                </div>

                <!-- Status da Conex√£o -->
                <h4>üìä Status do Sistema</h4>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="test-supabase-connection">
                        üîó Testar Conex√£o Supabase
                    </button>
                    <span id="supabase-status" class="connection-status"></span>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-success" id="create-supabase-tables">
                        ÔøΩ Criar Tabelas no Supabase
                    </button>
                    <small>Cria automaticamente as tabelas necess√°rias no banco</small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-config">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Recibo -->
    <div class="modal" id="recibo-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gerar Recibo</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div id="recibo-preview" class="recibo-preview">
                <!-- Preview do recibo ser√° gerado aqui -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="app.closeReciboModal()">Fechar</button>
                <button type="button" class="btn btn-primary" onclick="app.baixarReciboPDF()">üì• Baixar PDF</button>
                <button type="button" class="btn btn-success" onclick="app.enviarReciboEmail()">üìß Enviar Email</button>
            </div>
        </div>
    </div>

    <!-- Modal Usu√°rio -->
    <div class="modal" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">Novo Usu√°rio</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="user-form">
                <div class="form-group">
                    <label for="user-nome">Nome Completo</label>
                    <input type="text" id="user-nome" required>
                </div>
                <div class="form-group">
                    <label for="user-email">Email</label>
                    <input type="email" id="user-email" required>
                </div>
                <div class="form-group">
                    <label for="user-senha">Senha</label>
                    <input type="password" id="user-senha" required minlength="6">
                    <small>M√≠nimo 6 caracteres</small>
                </div>
                <div class="form-group">
                    <label for="user-tipo">Tipo de Usu√°rio</label>
                    <select id="user-tipo" required>
                        <option value="user">Usu√°rio Comum</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="user-ativo" checked>
                        Usu√°rio Ativo
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Salvar Usu√°rio</button>
                    <button type="button" class="btn btn-secondary" id="cancel-user">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

        <!-- Toast para notifica√ß√µes -->
        <div id="toast" class="toast"></div>
        
    </div> <!-- Fim Main Container -->

    <!-- Scripts -->
    <script src="js/env-config.js"></script>
    <script src="js/config.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/migration.js"></script>
    <script src="js/app.js"></script>
</body>
</html>