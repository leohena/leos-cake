<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo's Cake - Sistema de Pr√©-Vendas</title>
    
    <meta name="theme-color" content="#ff6b9d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="images/logo-png.png">
    <link rel="apple-touch-icon" href="images/logo-png.png">
    
    <!-- Fonts e √çcones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Bibliotecas Externas -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.emailjs.com/sdk/dist/email.min.js"></script>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #ff6b9d, #ffa726); align-items: center; justify-content: center; z-index: 9999; flex-direction: column;">
        <img src="images/logo-png.png" alt="Leo's Cake" style="width: 100px; height: 100px; margin-bottom: 20px; border-radius: 10px;">
        <h1 style="color: white; margin: 0; font-size: 2rem;">Leo's Cake</h1>
        <p style="color: rgba(255,255,255,0.8); margin: 10px 0; font-size: 1rem;">Sistema de Pr√©-Vendas</p>
        <div style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin-top: 20px;"></div>
    </div>

    <!-- Login Screen -->
    <div id="login-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); z-index: 100; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 2rem; width: 90%; max-width: 400px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div style="text-align: center; margin-bottom: 2rem;">
                <img src="images/logo-png.png" alt="Leo's Cake" style="width: 80px; height: 80px; border-radius: 8px; margin-bottom: 1rem;">
                <h1 style="margin: 0; font-size: 1.5rem; color: #333;">Leo's Cake</h1>
                <p style="margin: 0.5rem 0 0 0; color: #666;">Sistema de Pr√©-Vendas</p>
            </div>

            <form id="login-form" style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500;">Email</label>
                    <input type="email" id="login-email" placeholder="seu@email.com" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500;">Senha</label>
                    <input type="password" id="login-password" placeholder="Sua senha" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;">
                </div>
                <button type="submit" style="padding: 0.75rem; background: linear-gradient(135deg, #ff6b9d, #ffa726); color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 0.5rem;">
                    Entrar
                </button>
            </form>

            <div id="login-error" style="display: none; margin-top: 1rem; padding: 0.75rem; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px; text-align: center;"></div>


        </div>
    </div>

    <!-- Main Container (Dashboard) -->
    <div id="main-container" style="display: none;">
        <!-- Este container ser√° usado se necess√°rio -->
    </div>

    <!-- Anima√ß√£o de Loading -->
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .splash-screen {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b9d, #ffa726);
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }
    </style>

    <!-- Scripts -->
    <script>
        // Limpar Service Workers antigos
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => {
                    registration.unregister().catch(err => {
                        console.warn('Erro ao desregistrar SW:', err);
                    });
                });
            });
        }
    </script>

    <script src="src/supabase.js"></script>
    <script src="src/i18n.js"></script>
    <script src="src/auth.js"></script>

    <script>
        // Sistema de Login
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Carregando sistema de login...');

            // Testar conex√£o com Supabase
            setTimeout(async () => {
                const result = await window.testSupabaseConnection?.();
                if (result?.success) {
                    console.log('‚úÖ ' + result.message);
                } else {
                    console.warn('‚ö†Ô∏è ' + (result?.message || 'Erro ao conectar ao Supabase'));
                }
            }, 1000);

            // Aguardar AuthSystem estar pronto
            let attempts = 0;
            while (!window.authSystem?.isInitialized && attempts < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }

            // Se j√° est√° logado, ir para dashboard
            if (window.authSystem?.isLoggedIn()) {
                console.log('‚úÖ Usu√°rio j√° autenticado, redirecionando...');
                window.location.href = 'dashboard.html';
                return;
            }

            // Esconder splash screen e mostrar login
            const splashScreen = document.getElementById('splash-screen');
            const loginContainer = document.getElementById('login-container');

            setTimeout(() => {
                if (splashScreen) splashScreen.style.display = 'none';
                if (loginContainer) loginContainer.style.display = 'flex';
            }, 1500);

            // Setup do formul√°rio de login
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');

            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const email = document.getElementById('login-email').value.trim();
                    const password = document.getElementById('login-password').value;

                    if (!email || !password) {
                        showLoginError('Preencha email e senha');
                        return;
                    }

                    try {
                        const result = await window.authSystem.login(email, password);

                        if (result.success) {
                            console.log('‚úÖ Login bem-sucedido');
                            window.location.href = 'dashboard.html';
                        } else {
                            showLoginError(result.message || 'Email ou senha incorretos');
                        }
                    } catch (error) {
                        console.error('Erro ao fazer login:', error);
                        showLoginError('Erro ao fazer login. Tente novamente.');
                    }
                });
            }

            function showLoginError(message) {
                if (loginError) {
                    loginError.textContent = message;
                    loginError.style.display = 'block';
                    setTimeout(() => {
                        loginError.style.display = 'none';
                    }, 5000);
                }
            }
        });
    </script>
</body>
</html>